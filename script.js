'use strict';

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –≤ –ª–æ–∫–∞–ª—å–Ω–µ —Å—Ö–æ–≤–∏—â–µ
function saveResult(startDate, endDate, result) {
  // –û—Ç—Ä–∏–º—É—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å—Ö–æ–≤–∏—â–∞ –∞–±–æ —Å—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π –ø—É—Å—Ç–∏–π –º–∞—Å–∏–≤
  const results = JSON.parse(localStorage.getItem('results')) || []; 
  // –î–æ–¥–∞—î–º–æ –Ω–æ–≤–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ –º–∞—Å–∏–≤—É
  results.push({ startDate, endDate, result });
  // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –æ–Ω–æ–≤–ª–µ–Ω–∏–π –º–∞—Å–∏–≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ª–æ–∫–∞–ª—å–Ω–µ —Å—Ö–æ–≤–∏—â–µ, –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏–≤—à–∏ –π–æ–≥–æ –Ω–∞ —Ä—è–¥–æ–∫ JSON
  localStorage.setItem('results', JSON.stringify(results));
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å—Ö–æ–≤–∏—â–∞ —ñ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —ó—Ö —É —Ç–∞–±–ª–∏—Ü—ñ
function loadResults() {
  // –û—Ç—Ä–∏–º—É—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å—Ö–æ–≤–∏—â–∞ –∞–±–æ —Å—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π –ø—É—Å—Ç–∏–π –º–∞—Å–∏–≤
  const results = JSON.parse(localStorage.getItem('results')) || [];
  // –û—Ç—Ä–∏–º—É—î–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ HTML-—Ç–∞–±–ª–∏—Ü—é –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∞
  const table = document.getElementById('results-table');

  // –ü—Ä–æ—Ö–æ–¥–∏–º–æ—Å—è –ø–æ –∫–æ–∂–Ω–æ–º—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É —ñ –¥–æ–¥–∞—î–º–æ –π–æ–≥–æ –¥–æ —Ç–∞–±–ª–∏—Ü—ñ
  for (let i = 0; i < results.length; i++) {
    const newRow = table.insertRow(-1); // –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π —Ä—è–¥–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü—ñ

    // –°—Ç–≤–æ—Ä—é—î–º–æ –∫–æ–º—ñ—Ä–∫–∏ –¥–ª—è –ø–æ—á–∞—Ç–∫–æ–≤–æ—ó –¥–∞—Ç–∏, –∫—ñ–Ω—Ü–µ–≤–æ—ó –¥–∞—Ç–∏, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É —ñ –∫–Ω–æ–ø–∫–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è
    const startDateCell = newRow.insertCell(0); // –°—Ç–≤–æ—Ä—é—î–º–æ –∫–æ–º—ñ—Ä–∫—É –¥–ª—è –ø–æ—á–∞—Ç–∫–æ–≤–æ—ó –¥–∞—Ç–∏
    const endDateCell = newRow.insertCell(1);   // –°—Ç–≤–æ—Ä—é—î–º–æ –∫–æ–º—ñ—Ä–∫—É –¥–ª—è –∫—ñ–Ω—Ü–µ–≤–æ—ó –¥–∞—Ç–∏
    const resultCell = newRow.insertCell(2);    // –°—Ç–≤–æ—Ä—é—î–º–æ –∫–æ–º—ñ—Ä–∫—É –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
    const deleteCell = newRow.insertCell(3);    // –°—Ç–≤–æ—Ä—é—î–º–æ –∫–æ–º—ñ—Ä–∫—É –¥–ª—è –∫–Ω–æ–ø–∫–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è

    // –ó–∞–ø–æ–≤–Ω—é—î–º–æ –∫–æ–º—ñ—Ä–∫–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏ –∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
    startDateCell.innerHTML = results[i].startDate; // –ó–∞–ø–æ–≤–Ω—é—î–º–æ –∫–æ–º—ñ—Ä–∫—É –ø–æ—á–∞—Ç–∫–æ–≤–æ—ó –¥–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º –∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
    endDateCell.innerHTML = results[i].endDate;     // –ó–∞–ø–æ–≤–Ω—é—î–º–æ –∫–æ–º—ñ—Ä–∫—É –∫—ñ–Ω—Ü–µ–≤–æ—ó –¥–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º –∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
    resultCell.innerHTML = results[i].result;       // –ó–∞–ø–æ–≤–Ω—é—î–º–æ –∫–æ–º—ñ—Ä–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –∑–Ω–∞—á–µ–Ω–Ω—è–º –∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤;

    // –°—Ç–≤–æ—Ä—é—î–º–æ –∫–Ω–æ–ø–∫—É –≤–∏–¥–∞–ª–µ–Ω–Ω—è
    const deleteButton = document.createElement('button'); // –°—Ç–≤–æ—Ä—é—î–º–æ –∫–Ω–æ–ø–∫—É –≤–∏–¥–∞–ª–µ–Ω–Ω—è
    deleteButton.innerHTML = 'Delete üóëÔ∏è';
    deleteButton.classList.add('delete-button'); // –î–æ–¥–∞—î–º–æ –∫–ª–∞—Å –¥–æ –∫–Ω–æ–ø–∫–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è
    deleteButton.setAttribute('data-index', i); // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∞—Ç—Ä–∏–±—É—Ç "data-index" –∫–Ω–æ–ø–∫–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∑ —ñ–Ω–¥–µ–∫—Å–æ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
    deleteButton.addEventListener('click', deleteResult); // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ –ø–æ–¥—ñ—ó –Ω–∞ –∫–Ω–æ–ø–∫—É –≤–∏–¥–∞–ª–µ–Ω–Ω—è

    // –î–æ–¥–∞—î–º–æ –∫–Ω–æ–ø–∫—É –≤–∏–¥–∞–ª–µ–Ω–Ω—è –¥–æ –∫–æ–º—ñ—Ä–∫–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è
    deleteCell.appendChild(deleteButton);
  }
}

// ‚ö†Ô∏è‚ö†Ô∏è –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É ‚ö†Ô∏è‚ö†Ô∏è
function deleteResult(event) {
  // –û—Ç—Ä–∏–º—É—î–º–æ —ñ–Ω–¥–µ–∫—Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É, —è–∫–∏–π –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–¥–∞–ª–∏—Ç–∏
  const index = event.target.getAttribute('data-index');
  // –û—Ç—Ä–∏–º—É—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å—Ö–æ–≤–∏—â–∞
  const results = JSON.parse(localStorage.getItem('results')) || [];
  // –í–∏–¥–∞–ª—è—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑ –º–∞—Å–∏–≤—É –∑–∞ –π–æ–≥–æ —ñ–Ω–¥–µ–∫—Å–æ–º
  results.splice(index, 1);
  // –û–Ω–æ–≤–ª—é—î–º–æ –ª–æ–∫–∞–ª—å–Ω–µ —Å—Ö–æ–≤–∏—â–µ, –∑–±–µ—Ä—ñ–≥–∞—é—á–∏ –æ–Ω–æ–≤–ª–µ–Ω–∏–π –º–∞—Å–∏–≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
  localStorage.setItem('results', JSON.stringify(results));

  // –û—Ç—Ä–∏–º—É—î–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ç–∞–±–ª–∏—Ü—é
  const table = document.getElementById('results-table');
  // –í–∏–¥–∞–ª—è—î–º–æ —Ä—è–¥–æ–∫ —Ç–∞–±–ª–∏—Ü—ñ, –Ω–∞ —è–∫–æ–º—É –±—É–ª–∞ –Ω–∞—Ç–∏—Å–Ω—É—Ç–∞ –∫–Ω–æ–ø–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è
  table.deleteRow(event.target.parentNode.parentNode.rowIndex);
}

// ‚ö†Ô∏è‚ö†Ô∏è –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–±—á–∏—Å–ª–µ–Ω–Ω—è —Ä—ñ–∑–Ω–∏—Ü—ñ –≤ —á–∞—Å—ñ ‚ö†Ô∏è‚ö†Ô∏è
function calculateTime() {
  const startDate = document.getElementById('start-date').value; // –û—Ç—Ä–∏–º—É—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ—á–∞—Ç–∫–æ–≤–æ—ó –¥–∞—Ç–∏ –∑ HTML-—Ñ–æ—Ä–º–∏
  const endDate = document.getElementById('end-date').value; // –û—Ç—Ä–∏–º—É—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è –∫—ñ–Ω—Ü–µ–≤–æ—ó –¥–∞—Ç–∏ –∑ HTML-—Ñ–æ—Ä–º–∏
  //const preset = document.getElementById('preset').value;
  //const options = document.getElementById('options').value;
  //const measure = document.getElementById('measure').value; // –û—Ç—Ä–∏–º—É—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è "measure" –∑ HTML-—Ñ–æ—Ä–º–∏

  // ‚ö†Ô∏è‚ö†Ô∏è –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ—Å—Ç—å –¥–∞—Ç ‚ö†Ô∏è‚ö†Ô∏è
  if (startDate > endDate) {
    alert('–ü–æ—á–∞—Ç–∫–æ–≤–∞ –¥–∞—Ç–∞ –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ —Ä–∞–Ω—ñ—à–µ –∞–±–æ —Ä—ñ–≤–Ω–æ—é –∫—ñ–Ω—Ü–µ–≤—ñ–π –¥–∞—Ç—ñ');
    return;
  }

  const measure = document.getElementById('measure').value;

  // –ö–æ–Ω–≤–µ—Ä—Ç—É—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤—É —Ç–∞ –∫—ñ–Ω—Ü–µ–≤—É –¥–∞—Ç–∏ –≤ –æ–±'—î–∫—Ç–∏ JavaScript Date —ñ –æ—Ç—Ä–∏–º—É—î–º–æ —ó—Ö —á–∞—Å –≤ –º—ñ–ª—ñ—Å–µ–∫—É–Ω–¥–∞—Ö
  const startTime = new Date(startDate).getTime(); 
  const endTime = new Date(endDate).getTime(); 

  // –û–±—á–∏—Å–ª—é—î–º–æ —Ä—ñ–∑–Ω–∏—Ü—é –≤ —á–∞—Å—ñ
  const timeDiff = endTime - startTime;

  // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ –∑–º—ñ–Ω–Ω—ñ –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É —Ç–∞ –æ–¥–∏–Ω–∏—Ü—ñ –≤–∏–º—ñ—Ä—É
  let result;
  let unit;

  // –í–∏–±–∏—Ä–∞—î–º–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Ç–∞ –æ–¥–∏–Ω–∏—Ü—é –≤–∏–º—ñ—Ä—É –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –∑–Ω–∞—á–µ–Ω–Ω—è "measure"
  switch (measure) { 
    case 'days':
      result = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
      unit = '–¥–Ω—ñ–≤';
      break;
    case 'hours':
      result = Math.floor(timeDiff / (1000 * 60 * 60));
      unit = '–≥–æ–¥–∏–Ω';
      break;
    case 'minutes':
      result = Math.floor(timeDiff / (1000 * 60));
      unit = '—Ö–≤–∏–ª–∏–Ω';
      break;
    case 'seconds':
      result = Math.floor(timeDiff / 1000);
      unit = '—Å–µ–∫—É–Ω–¥';
      break;
  }

  // –û—Ç—Ä–∏–º—É—î–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ç–∞–±–ª–∏—Ü—é
  const table = document.getElementById('results-table');
  // –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π —Ä—è–¥–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü—ñ
  const newRow = table.insertRow(-1);

  // –°—Ç–≤–æ—Ä—é—î–º–æ –∫–æ–º—ñ—Ä–∫–∏ –¥–ª—è –ø–æ—á–∞—Ç–∫–æ–≤–æ—ó –¥–∞—Ç–∏, –∫—ñ–Ω—Ü–µ–≤–æ—ó –¥–∞—Ç–∏, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É —ñ –∫–Ω–æ–ø–∫–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è
  const startDateCell = newRow.insertCell(0); // –°—Ç–≤–æ—Ä—é—î–º–æ –∫–æ–º—ñ—Ä–∫—É –¥–ª—è –ø–æ—á–∞—Ç–∫–æ–≤–æ—ó –¥–∞—Ç–∏
  const endDateCell = newRow.insertCell(1);   // –°—Ç–≤–æ—Ä—é—î–º–æ –∫–æ–º—ñ—Ä–∫—É –¥–ª—è –∫—ñ–Ω—Ü–µ–≤–æ—ó –¥–∞—Ç–∏
  const resultCell = newRow.insertCell(2);    // –°—Ç–≤–æ—Ä—é—î–º–æ –∫–æ–º—ñ—Ä–∫—É –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
  const deleteCell = newRow.insertCell(3);    // –°—Ç–≤–æ—Ä—é—î–º–æ –∫–æ–º—ñ—Ä–∫—É –¥–ª—è –∫–Ω–æ–ø–∫–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è

  // –ó–∞–ø–æ–≤–Ω—é—î–º–æ –∫–æ–º—ñ—Ä–∫–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏ –∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
  startDateCell.innerHTML = startDate;        // –ó–∞–ø–æ–≤–Ω—é—î–º–æ –∫–æ–º—ñ—Ä–∫—É –ø–æ—á–∞—Ç–∫–æ–≤–æ—ó –¥–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º –∑ —Ñ–æ—Ä–º–∏
  endDateCell.innerHTML = endDate;            // –ó–∞–ø–æ–≤–Ω—é—î–º–æ –∫–æ–º—ñ—Ä–∫—É –∫—ñ–Ω—Ü–µ–≤–æ—ó –¥–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º –∑ —Ñ–æ—Ä–º–∏
  resultCell.innerHTML = result + ' ' + unit; // –ó–∞–ø–æ–≤–Ω—é—î–º–æ –∫–æ–º—ñ—Ä–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É

  // –°—Ç–≤–æ—Ä—é—î–º–æ –∫–Ω–æ–ø–∫—É –≤–∏–¥–∞–ª–µ–Ω–Ω—è
  const deleteButton = document.createElement('button');  // –°—Ç–≤–æ—Ä—é—î–º–æ –∫–Ω–æ–ø–∫—É –≤–∏–¥–∞–ª–µ–Ω–Ω—è
  deleteButton.innerHTML = 'Delete üóëÔ∏è'; 
  deleteButton.classList.add('delete-button');            // –î–æ–¥–∞—î–º–æ –∫–ª–∞—Å –¥–æ –∫–Ω–æ–ø–∫–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è
  deleteButton.setAttribute('data-index', table.rows.length - 2); // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∞—Ç—Ä–∏–±—É—Ç "data-index" –∫–Ω–æ–ø–∫–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∑ —ñ–Ω–¥–µ–∫—Å–æ–º –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ —Ä—è–¥–∫–∞ —Ç–∞–±–ª–∏—Ü—ñ
  deleteButton.addEventListener('click', deleteResult);   // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ –ø–æ–¥—ñ—ó –Ω–∞ –∫–Ω–æ–ø–∫—É –≤–∏–¥–∞–ª–µ–Ω–Ω—è

  // –î–æ–¥–∞—î–º–æ –∫–Ω–æ–ø–∫—É –≤–∏–¥–∞–ª–µ–Ω–Ω—è –¥–æ –∫–æ–º—ñ—Ä–∫–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è
  deleteCell.appendChild(deleteButton);

  // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ª–æ–∫–∞–ª—å–Ω–µ —Å—Ö–æ–≤–∏—â–µ
  saveResult(startDate, endDate, result + ' ' + unit);
}

// –§—É–Ω–∫—Ü—ñ—è, —è–∫–∞ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
document.addEventListener('DOMContentLoaded', function () {
  loadResults(); // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å—Ö–æ–≤–∏—â–∞ —ñ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ —ó—Ö —É —Ç–∞–±–ª–∏—Ü—ñ
});
